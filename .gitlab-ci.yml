image: node:8

stages:
    - build
    - test
    - run

build:
    stage: build
    script:
        - npm install
        - npm run build
    artifacts:
        paths:
            - bin/
            - dist/
            - node_modules/
            - resources/
            - src/
            - test/
            - package.json
            - tsconfig.build.json
            - tsconfig.json

build:linux:
    image: node:8 # TODO: change
    stage: build
    script: 
        - mkdir /usr/local/src/boiler
        - cp -r . /usr/local/src/boiler
        - cd /usr/local/src/boiler
        - chmod 755 bin/*
        - bin/install
    artifacts:
      paths:
          - /usr/local/bin/boiler
          - /usr/local/src/boiler/

test:
    stage: test
    script: npm test
    dependencies:
      - build
            
run:
    stage: run
    script:
        - mkdir $HOME/boiler
        - export BOILER_PATH=$HOME/boiler
        - npm start -- path

run:linux:
  stage: run
  script: boiler path
  dependencies:
    - build:linux